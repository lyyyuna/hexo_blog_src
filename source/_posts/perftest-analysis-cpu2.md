title: Linux 性能分析 - 上下文切换
date: 2020-06-18 16:30:38
categories:
- 测试
tags:
- Linux 性能分析
series: Linux 性能分析
---

## 前言

上一篇文章中提到，处于可运行状态的进程越多，平均负载也越高。

有人可能会有疑问，这种计算方法合理吗？同样是 100% 的 CPU 使用率，有 3 个可运行进程的系统的平均负载，是有 1 个可运行进程系统的负载的 3 倍？本文就试图从 CPU 上下文切换的角度来解释这一指标的合理性。

## 上下文切换定义

### CPU 上下文切换

虽然系统的 CPU 个数有限，但能支持同时运行个任务。当然这种同时只是宏观上的假象，如果从微观角度观察，会发现系统在不停轮流切换任务，使得每个任务都能获得运行的机会。

CPU 是状态 + 存储的模型，其符合图灵机这种理想设备：
1. 内存
2. PC 指针指向下一条待运行的指令（状态）
3. 计算规则
4. 其他辅助计算的寄存器（状态）

多任务的每个任务都有自己的状态。当任务 1 切出，任务 2 切入时，CPU 的状态也要切换成任务 2 上一次切出时的状态，这样任务 2 才能继续运行。这些状态是 CPU 上下文，CPU 上下文切换